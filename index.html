<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>အရောင်း & စာရင်းချုပ် (Offline)</title>
    <!-- CDN Links for Offline capable initial load -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Custom Icon Component (Simple SVG replacements for Lucide)
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                trending: <path d="m22 7-8.5 8.5-5-5L2 17" />,
                wallet: <path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" />,
                package: <path d="m7.5 4.27 9 5.15" />,
                plus: <path d="M12 5v14M5 12h14" />,
                save: <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />,
                trash: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />,
                edit: <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />,
                lock: <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [inventory, setInventory] = useState([]);
            const [salesHistory, setSalesHistory] = useState([]);
            const [initialInvestment, setInitialInvestment] = useState(0);
            const [view, setView] = useState('inventory');
            const [editingId, setEditingId] = useState(null);
            const [sellingItem, setSellingItem] = useState(null);
            const [formData, setFormData] = useState({ itemName: '', capitalPrice: '', sellingPrice: '', quantity: '1' });
            const [sellData, setSellData] = useState({ price: '', qty: '1' });

            useEffect(() => {
                const savedInv = localStorage.getItem('offline_inv_v4');
                const savedSales = localStorage.getItem('offline_sales_v4');
                const savedInvestment = localStorage.getItem('offline_investment_v4');
                if (savedInv) setInventory(JSON.parse(savedInv));
                if (savedSales) setSalesHistory(JSON.parse(savedSales));
                if (savedInvestment) setInitialInvestment(parseFloat(savedInvestment));
            }, []);

            useEffect(() => {
                localStorage.setItem('offline_inv_v4', JSON.stringify(inventory));
                localStorage.setItem('offline_sales_v4', JSON.stringify(salesHistory));
                localStorage.setItem('offline_investment_v4', initialInvestment.toString());
            }, [inventory, salesHistory, initialInvestment]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (passwordInput === '1234') { setIsAuthenticated(true); } 
                else { alert('Password မှားနေပါသည်။'); }
            };

            const saveItem = (e) => {
                e.preventDefault();
                if (editingId) {
                    setInventory(inventory.map(item => item.id === editingId ? { ...item, name: formData.itemName, capital: parseFloat(formData.capitalPrice), selling: parseFloat(formData.sellingPrice), totalQty: parseInt(formData.quantity), remainingQty: parseInt(formData.quantity) } : item));
                    setEditingId(null);
                } else {
                    const newItem = { id: Date.now(), name: formData.itemName, capital: parseFloat(formData.capitalPrice), selling: parseFloat(formData.sellingPrice), totalQty: parseInt(formData.quantity), remainingQty: parseInt(formData.quantity), date: new Date().toLocaleDateString() };
                    setInventory([newItem, ...inventory]);
                }
                setFormData({ itemName: '', capitalPrice: '', sellingPrice: '', quantity: '1' });
            };

            const handleSell = (e) => {
                e.preventDefault();
                const qty = parseInt(sellData.qty);
                if (qty > sellingItem.remainingQty) return alert('လက်ကျန်မလုံလောက်ပါ');
                const newSale = { id: Date.now(), inventoryId: sellingItem.id, name: sellingItem.name, capital: sellingItem.capital, soldPrice: parseFloat(sellData.price), qty, date: new Date().toLocaleDateString() };
                setInventory(inventory.map(item => item.id === sellingItem.id ? { ...item, remainingQty: item.remainingQty - qty } : item));
                setSalesHistory([newSale, ...salesHistory]);
                setSellingItem(null);
            };

            const totalInventoryValue = inventory.reduce((sum, item) => sum + (item.capital * item.totalQty), 0);
            const totalProfit = salesHistory.reduce((sum, sale) => sum + ((sale.soldPrice - sale.capital) * sale.qty), 0);
            const totalRevenue = salesHistory.reduce((sum, sale) => sum + (sale.soldPrice * sale.qty), 0);
            const cashBalance = initialInvestment - totalInventoryValue + totalRevenue;

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md text-center">
                            <Icon name="lock" size={48} className="mx-auto text-blue-600 mb-4" />
                            <h1 className="text-2xl font-bold mb-6">Admin Login</h1>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input type="password" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} className="w-full p-4 bg-slate-100 rounded-2xl text-center text-xl" placeholder="Password (1234)" />
                                <button className="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700">ဝင်မည်</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8">
                    <header className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-black text-slate-800 flex items-center gap-2">
                            <Icon name="trending" className="text-blue-600" /> အရောင်း & စာရင်း
                        </h1>
                        <button onClick={() => { const val = prompt("ရင်းနှီးငွေသတ်မှတ်ပါ", initialInvestment); if(val) setInitialInvestment(parseFloat(val)); }} className="bg-white px-4 py-2 rounded-xl border font-bold text-sm shadow-sm">ရင်းနှီးငွေပြင်ရန်</button>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div className="bg-white p-6 rounded-3xl border">
                            <div className="text-xs font-bold text-slate-400 mb-1 uppercase">Investment</div>
                            <div className="text-xl font-black">{initialInvestment.toLocaleString()} Ks</div>
                        </div>
                        <div className="bg-white p-6 rounded-3xl border">
                            <div className="text-xs font-bold text-slate-400 mb-1 uppercase">Stock Value</div>
                            <div className="text-xl font-black">{totalInventoryValue.toLocaleString()} Ks</div>
                        </div>
                        <div className="bg-white p-6 rounded-3xl border">
                            <div className="text-xs font-bold text-green-600 mb-1 uppercase">Total Profit</div>
                            <div className="text-xl font-black text-green-600">{totalProfit.toLocaleString()} Ks</div>
                        </div>
                        <div className="bg-slate-900 p-6 rounded-3xl text-white">
                            <div className="text-xs font-bold text-blue-400 mb-1 uppercase">Cash Balance</div>
                            <div className="text-xl font-black">{cashBalance.toLocaleString()} Ks</div>
                        </div>
                    </div>

                    <div className="flex gap-2 mb-8 bg-slate-200 p-1 rounded-2xl w-fit">
                        <button onClick={() => setView('inventory')} className={`px-6 py-2 rounded-xl font-bold text-sm ${view === 'inventory' ? 'bg-white text-blue-600 shadow' : 'text-slate-500'}`}>STOCK</button>
                        <button onClick={() => setView('sales')} className={`px-6 py-2 rounded-xl font-bold text-sm ${view === 'sales' ? 'bg-white text-green-600 shadow' : 'text-slate-500'}`}>SALES</button>
                    </div>

                    {view === 'inventory' ? (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <div className="lg:col-span-4 bg-white p-6 rounded-3xl border h-fit">
                                <h2 className="font-bold mb-4">{editingId ? 'စာရင်းပြင်ရန်' : 'Stock သစ်ထည့်ရန်'}</h2>
                                <form onSubmit={saveItem} className="space-y-4">
                                    <input type="text" value={formData.itemName} onChange={e => setFormData({...formData, itemName: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl border" placeholder="ပစ္စည်းအမည်" required />
                                    <div className="grid grid-cols-2 gap-2">
                                        <input type="number" value={formData.capitalPrice} onChange={e => setFormData({...formData, capitalPrice: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl border" placeholder="ဝယ်ဈေး" required />
                                        <input type="number" value={formData.sellingPrice} onChange={e => setFormData({...formData, sellingPrice: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl border" placeholder="ရောင်းဈေး" required />
                                    </div>
                                    <input type="number" value={formData.quantity} onChange={e => setFormData({...formData, quantity: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl border" placeholder="အရေအတွက်" required />
                                    <button className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">သိမ်းဆည်းမည်</button>
                                </form>
                            </div>
                            <div className="lg:col-span-8 bg-white rounded-3xl border overflow-hidden">
                                <table className="w-full text-left border-collapse">
                                    <thead className="bg-slate-50">
                                        <tr className="text-[10px] font-bold text-slate-400 uppercase">
                                            <th className="p-4">Item</th>
                                            <th className="p-4 text-center">Stock</th>
                                            <th className="p-4 text-right">Price</th>
                                            <th className="p-4 text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y">
                                        {inventory.map(item => (
                                            <tr key={item.id} className="hover:bg-slate-50">
                                                <td className="p-4 font-bold text-slate-700">{item.name}</td>
                                                <td className="p-4 text-center"><span className="bg-blue-50 text-blue-600 px-2 py-1 rounded text-xs font-bold">{item.remainingQty} / {item.totalQty}</span></td>
                                                <td className="p-4 text-right">
                                                    <div className="text-xs text-slate-400">ရင်း: {item.capital}</div>
                                                    <div className="font-bold text-green-600">ရောင်း: {item.selling}</div>
                                                </td>
                                                <td className="p-4 text-center">
                                                    <button onClick={() => { setSellingItem(item); setSellData({price: item.selling, qty: '1'}); }} className="bg-green-500 text-white px-3 py-1 rounded-lg text-xs font-bold mr-2">SELL</button>
                                                    <button onClick={() => { setEditingId(item.id); setFormData({itemName: item.name, capitalPrice: item.capital, sellingPrice: item.selling, quantity: item.totalQty}); }} className="text-slate-300 hover:text-blue-500 mr-2"><Icon name="edit" size={16} /></button>
                                                    <button onClick={() => { if(confirm('ဖျက်မှာလား?')) setInventory(inventory.filter(i => i.id !== item.id)); }} className="text-slate-300 hover:text-red-500"><Icon name="trash" size={16} /></button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-white rounded-3xl border overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="bg-slate-50">
                                    <tr className="text-[10px] font-bold text-slate-400 uppercase">
                                        <th className="p-4">Date / Item</th>
                                        <th className="p-4 text-center">Qty</th>
                                        <th className="p-4 text-right">Sold Price</th>
                                        <th className="p-4 text-right">Profit</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y">
                                    {salesHistory.map(sale => (
                                        <tr key={sale.id}>
                                            <td className="p-4 font-bold">{sale.name}<br/><span className="text-[10px] text-slate-400">{sale.date}</span></td>
                                            <td className="p-4 text-center">{sale.qty}</td>
                                            <td className="p-4 text-right">{sale.soldPrice.toLocaleString()}</td>
                                            <td className="p-4 text-right font-bold text-green-600">{((sale.soldPrice - sale.capital) * sale.qty).toLocaleString()} Ks</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {sellingItem && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4">
                            <div className="bg-white p-8 rounded-3xl w-full max-w-sm">
                                <h2 className="font-bold mb-4 uppercase">ရောင်းချမည်: {sellingItem.name}</h2>
                                <form onSubmit={handleSell} className="space-y-4">
                                    <input type="number" value={sellData.price} onChange={e => setSellData({...sellData, price: e.target.value})} className="w-full p-4 bg-slate-50 border rounded-2xl font-bold" placeholder="ရောင်းဈေး" required />
                                    <input type="number" value={sellData.qty} onChange={e => setSellData({...sellData, qty: e.target.value})} className="w-full p-4 bg-slate-50 border rounded-2xl font-bold" max={sellingItem.remainingQty} min="1" required />
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setSellingItem(null)} className="flex-1 py-3 bg-slate-100 rounded-xl font-bold">CANCEL</button>
                                        <button type="submit" className="flex-1 py-3 bg-green-600 text-white rounded-xl font-bold">SELL NOW</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>